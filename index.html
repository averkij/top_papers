
<!DOCTYPE html>
<html>
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C1CRWDNJ1J"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-C1CRWDNJ1J');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>HF (2 статьи)</title>
    <link rel="icon" href="favicon.svg" sizes="any" type="image/svg+xml">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0989eacf;
            --secondary-color: #fff;
            --background-color: #f5f5f5;
            --text-color: #333333;
            --header-color: #0989eacf;
            --body-color: #f5f5f5;
        }
        body {
            font-family: 'Roboto Slab', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            padding: 1.6em 0;
            text-align: center;
        }
        h1 {
            font-size: 2.4em;
            margin: 0;
            font-weight: 700;
        }
        h2 {
            # color: var(--primary-color);
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 0.5em;
        }
        header p {
            font-size: 1.2em;
            margin-top: 0.5em;
            font-weight: 300;
        }
        main {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2em;
            padding: 10px 0 20px 0;
        }
        body.dark-tmeme>header {
            background-color: background-color: #333333;
            color: white;
        }
        body.dark-theme>div>main>article>div.article-content>p.meta {
            color: #fff;
        }
        body.light-theme>div>main>article>div.article-content>p.meta {
            color: #555;
        }
        body.dark-theme>div>main>article>div.article-content>p.pub-date {
            color: #ccc;
        }
        body.light-theme>div>main>article>div.article-content>p.pub-date {
            color: #555;
        }
        body.dark-theme>div>main>article>div.article-content>p.tags {
            color: #ccc;
        }
        body.light-theme>div>main>article>div.article-content>p.tags {
            color: #555;
        }
        body.light-theme>header {
            background-color: var(--header-color);
            color: white;
        }
        article {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            transition: background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .article-content {
            padding: 1.5em;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
            cursor: pointer;
        }
        body.dark-theme>div>main>article {
            background-color: #444;
        }
        body.light-theme>div>main>article {
            background-color: #fff;
        }
        body.dark-theme>div>main>article:hover {
            background-color: #414141;
        }
        body.light-theme>div>main>article:hover {
            background-color: #fafafa;
        }
        .meta {
            font-size: 0.9em;
            margin-bottom: 0em;
        }
        .pub-date {
            font-size: 0.9em;
            margin-bottom: 0.8em;
            font-weight: 300;
        }
        .tags {
            font-size: 0.9em;
            margin-bottom: 1em;
            position: absolute;
            bottom: 10px;
            font-weight: 300;
            font-family: 'Roboto Slab';
        }
        .background-digit {
            position: absolute;
            bottom: -20px;
            right: -10px;
            font-size: 12em;
            font-weight: bold;
            color: rgba(0, 0, 0, 0.03);
            z-index: 0;
            line-height: 1;
        }
        .abstract {
            position: relative;
            max-height: 170px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            cursor: pointer;
        }
        .abstract.expanded {
            max-height: 1000px;
        }
        .abstract-toggle {
            position: absolute;
            bottom: 4px;
            right: 0;
            cursor: pointer;
            color: var(--primary-color);
            float: right;
            font-weight: 400;
        }
        .explanation {
            background-color: #e8f5e9;
            border-left: 4px solid var(--secondary-color);
            padding: 1em;
            margin-top: 1.5em;
        }
        .links {
            margin-top: 1.5em;
            margin-bottom: 80px;
        }
        a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        a:hover {
            color: var(--secondary-color);
        }
        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1em 0;
            margin-top: 2em;
        }
        .light-theme {
            background-color: var(--body-color);
            color: #333333;
        }
        .dark-theme {
            background-color: #333333;
            color: #ffffff;
        }
        .theme-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(20px);
        }
        .switch-label {
            margin-right: 10px;
        }
        .update-info-container {
            margin-top: 15px;
            margin-bottom: 0px;
            text-align: left;
        }
        .sort-container {
            margin-top: 15px;
            margin-bottom: 0px;
            text-align: right;
        }
        .sub-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .update-info-container {
            flex: 1;
        }
        .sort-container {
            flex: 2;
        }
        .sort-dropdown {
            padding: 5px 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: white;
            color: var(--text-color);
            font-family: 'Roboto Slab', sans-serif;
        }
        .sort-label {
            margin-right: 10px;
            font-size: 1.0em !important;
        }        
        .dark-theme .sort-dropdown {
            background-color: #444;
            color: white;
            border-color: var(--text-color);
        }
        .title-sign {
            display: inline-block;
            transition: all 0.5s ease;            
        }
        .rotate {
            transform: rotate(45deg) translateY(-6px);
            transform-origin: center;
        }
        .title-text {
            display: inline;
            padding-left: 10px;
        }
        .category-filters {
            margin-top: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .category-button {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            border-radius: 15px;
            background-color: #f0f0f0;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .category-button.active {
            background-color: var(--primary-color);
            color: white;
        }
        .dark-theme .category-button {
            background-color: #555;
            color: #fff;
        }
        .dark-theme .category-button.active {
            background-color: var(--primary-color);
        }
        .category-toggle {
            display: none;
            margin-bottom: 10px;
            margin-top: 15px;
            cursor: pointer;
        }
        .clear-categories {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            border-radius: 15px;
            background-color: #f0f0f0;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .clear-categories:hover {
            background-color: #bbb;
        }
        .svg-container {
            display: inline-block;
            position: relative;
            overflow: hidden;
        }

        .svg-container span {
            position: relative;
            z-index: 1;
        }

        .svg-container svg {
            position: absolute;
            bottom: 0;
            left: 0;
            z-index: 0;
        }
        
        @media (max-width: 768px) {
            .category-filters {
                display: none;
            }
            .category-toggle {
                display: inline-block;
                width: 100%;
                text-align: left;
            }
            .category-filters.expanded {
                display: block;
                margin-top: 10px;
            }
        }
        @media (max-width: 600px) {
            .sub-header-container {
                flex-direction: column;
                align-items: flex-start;
            }
            .update-info-container {
                text-align: left;
                width: 100%;
                margin-bottom: 0px;
            }
            .sort-container {
                margin-top: 0px;
                text-align: left;
                width: 100%;
            .sort-dropdown {
                float: right;
            }
            .sort-label {
                margin-top: 5px;
                float: left;
            }
        }
    </style>
    <script>
    function toggleAbstract(id) {
        var abstract = document.getElementById('abstract-' + id);
        var toggle = document.getElementById('toggle-' + id);
        if (abstract.classList.contains('expanded')) {
            abstract.classList.remove('expanded');
            toggle.textContent = '...';
        } else {
            abstract.classList.add('expanded');
            toggle.textContent = '';
        }
    }
    function getTimeDiffRu(dateString) {
        const timeUnits = {
            minute: ["минуту", "минуты", "минут"],
            hour: ["час", "часа", "часов"],
            day: ["день", "дня", "дней"]
        };

        function getRussianPlural(number, words) {
            if (number % 10 === 1 && number % 100 !== 11) {
                return words[0];
            } else if (number % 10 >= 2 && number % 10 <= 4 && (number % 100 < 10 || number % 100 >= 20)) {
                return words[1];
            } else {
                return words[2];
            }
        }

        const pastDate = new Date(dateString.replace(" ", "T") + ":00Z");
        const currentDate = new Date();
        const diffInSeconds = Math.floor((currentDate - pastDate) / 1000);

        const minutes = Math.floor(diffInSeconds / 60);
        const hours = Math.floor(diffInSeconds / 3600);
        const days = Math.floor(diffInSeconds / 86400);

        if (minutes == 0) {
            return 'только что';
        }
        else if (minutes < 60) {
            return `${minutes} ${getRussianPlural(minutes, timeUnits.minute)} назад`;
        } else if (hours < 24) {
            return `${hours} ${getRussianPlural(hours, timeUnits.hour)} назад`;
        } else {
            return `${days} ${getRussianPlural(days, timeUnits.day)} назад`;
        }
    }
    function formatArticlesTitle(number) {
        const lastDigit = number % 10;
        const lastTwoDigits = number % 100;

        let word;

        if (lastTwoDigits >= 11 && lastTwoDigits <= 14) {
            word = "статей";
        } else if (lastDigit === 1) {
            word = "статья";
        } else if (lastDigit >= 2 && lastDigit <= 4) {
            word = "статьи";
        } else {
            word = "статей";
        }

        return `${number} ${word}`;
    }
    </script>
</head>
<body class="light-theme">
    <header>
        <div class="container">
            <h1 class="title-sign" id="doomgrad-icon">🔺</h1><h1 class="title-text" id="doomgrad">хф дэйли</h1>
            <p>21 октября | 2 статьи</p>
        </div>
        <div class="theme-switch">
            <label class="switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </div>
    </header>
    <div class="container">
        <div class="sub-header-container">
            <div class="update-info-container">
                <label class="update-info-label" id="timeDiff"></label>
            </div>
            <div class="sort-container">
                <label class="sort-label">🔀 Сортировка по</label>
                <select id="sort-dropdown" class="sort-dropdown">
                    <option value="default">рейтингу</option>
                    <option value="pub_date">дате публикации</option>
                    <option value="issue_id">добавлению на HF</option>
                </select>
            </div>
        </div>
        <div class="category-toggle">
            <div class="svg-container">
                <span id="category-toggle">🔍 Фильтр</span>
                <svg height="3" width="200">
                    <line x1="0" y1="0" x2="200" y2="0" 
                        stroke="black" 
                        stroke-width="2" 
                        stroke-dasharray="3, 3" />
                </svg>
            </div>
        </div>
        <div class="category-filters" id="category-filters">
            <span class="clear-categories" id="clear-categories">🧹</span>
            <!-- Categories -->
        </div>
        <main id="articles-container">
            <!-- Articles -->
        </main>
    </div>
    <footer>
        <div class="container">
            <p><a style="color:white;" href="https://t.me/doomgrad">градиент обреченный</a> ✖️ <a style="color:white;" href="https://huggingface.co/papers">hugging face</a></p>
        </div>
    </footer>
    <script>    
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-theme');
            body.classList.toggle('dark-theme');

            const isDarkMode = body.classList.contains('dark-theme');
            localStorage.setItem('darkMode', isDarkMode);
            
            if (isDarkMode) {
                const title = document.getElementById('doomgrad');
                title.innerHTML = "хф найтли";
                const titleSign = document.getElementById('doomgrad-icon');
                titleSign.classList.add('rotate');
            }  else {
                const title = document.getElementById('doomgrad');
                title.innerHTML = "хф дэйли";
                const titleSign = document.getElementById('doomgrad-icon');
                titleSign.classList.remove('rotate');
            }
        }

        const articlesData = [{'id': 'https://huggingface.co/papers/2410.13674', 'title': 'Diffusion Curriculum: Synthetic-to-Real Generative Curriculum Learning via Image-Guided Diffusion', 'url': 'https://huggingface.co/papers/2410.13674', 'abstract': 'Low-quality or scarce data has posed significant challenges for training deep neural networks in practice. While classical data augmentation cannot contribute very different new data, diffusion models opens up a new door to build self-evolving AI by generating high-quality and diverse synthetic data through text-guided prompts. However, text-only guidance cannot control synthetic images\' proximity to the original images, resulting in out-of-distribution data detrimental to the model performance. To overcome the limitation, we study image guidance to achieve a spectrum of interpolations between synthetic and real images. With stronger image guidance, the generated images are similar to the training data but hard to learn. While with weaker image guidance, the synthetic images will be easier for model but contribute to a larger distribution gap with the original data. The generated full spectrum of data enables us to build a novel "Diffusion Curriculum (DisCL)". DisCL adjusts the image guidance level of image synthesis for each training stage: It identifies and focuses on hard samples for the model and assesses the most effective guidance level of synthetic images to improve hard data learning. We apply DisCL to two challenging tasks: long-tail (LT) classification and learning from low-quality data. It focuses on lower-guidance images of high-quality to learn prototypical features as a warm-up of learning higher-guidance images that might be weak on diversity or quality. Extensive experiments showcase a gain of 2.7% and 2.1% in OOD and ID macro-accuracy when applying DisCL to iWildCam dataset. On ImageNet-LT, DisCL improves the base model\'s tail-class accuracy from 4.4% to 23.64% and leads to a 4.02% improvement in all-class accuracy.', 'score': 2, 'issue_id': 193, 'pub_date': '2024-10-17', 'pub_date_ru': '17 октября', 'hash': '61d2689e00439256', 'data': {'desc': "Эта статья представляет новый метод под названием 'Diffusion Curriculum (DisCL)' для улучшения обучения нейронных сетей на ограниченных или некачественных данных. DisCL использует диффузионные модели для генерации синтетических данных, контролируя их близость к исходным изображениям с помощью управления изображениями. Метод адаптивно регулирует уровень управления изображениями на разных этапах обучения, фокусируясь на сложных примерах и определяя наиболее эффективный уровень синтеза. DisCL показал значительные улучшения в задачах классификации с длинным хвостом и обучении на данных низкого качества.", 'emoji': '🔄', 'title': 'Адаптивное обучение на синтетических данных для улучшения глубоких нейронных сетей', 'categories': ['#dataset', '#data', '#training', '#diffusion'], 'embedding': [0.03201978526322789, 0.0545290125606782, 0.08098961682678105, 0.014769977216304457, 0.02757789152946108, -0.022972492900207718, 0.017236183505072326, 0.014851730287644123, -0.13320230968829072, 0.08616728155090998, 0.055482792849895254, 0.005773780470905206, -0.12600807350033627, -0.056899840820524364, 0.0798995828044343, 0.0689992301090391, 0.06829070612372455, 0.006461865460855721, 0.006107603676063907, 0.08044459981560767, -0.030439233436439558, -0.002457688793506733, -0.00688084740511957, -0.012882854178176143, -0.005634119822817256, -0.08927389327304613, 0.06654664836212236, 0.07771951268108619, 0.056409324055410076, 0.027482512461212052, 0.060714966134701856, -0.003033363674129769, -0.09090894222791158, -0.0742313971578818, 0.05989743957861448, 0.07624796654305264, 0.020165651239288325, 0.16568536263293068, -0.07068878762458222, 0.006874035030261282, 0.0516949228553839, -0.124264021974698, 0.022550104040985598, 0.022686358813442605, -0.01956613294272855, -0.012460465526819488, 0.031120507298724568, 0.051613169368313304, 0.03907776148208873, 0.10491589417351509, -0.11815981773043566, 0.10954854188647067, -0.027305381984547072, -0.035262640325220515, -0.06643764787000417, 0.02043816182352965, -0.01843522217684652, -0.03891426074391147, -0.07864604388660101, -0.051640420530670174, 0.07221483193002022, -0.02075154603332431, 0.07815552296417747, 0.011363617674556218, -0.008502275351846809, -0.035453396383063926, -0.06398506820174206, 0.024157905990803478, -0.007146543535847965, 0.0462174932666748, 0.015001610433414093, -0.04728027820531931, -0.06082396662682003, -0.0651841089521709, -0.054610763969094145, 0.016050769375149244, -0.03785147580526696, 0.020492663108916058, 0.06044245451113321, -0.033954597004018865, 0.06758218421706463, 0.0848592465443269, -0.13494636329258367, -0.02534331908139924, -0.05608231426443699, -0.03580765941504853, -0.06447558496685635, -0.05978843285053238, -0.060387952186419486, -0.15216892329513218, 0.006659433685691954, -0.026474231925935916, -0.046299246753745395, 0.00010064729787725337, -0.023463007586667358, 0.014252210328160634, 0.03485387704717683, -0.025193439767091125, 0.1077499838788094, 0.048343063143963826, -0.08115312172226757, 0.04033130247857665, 0.04589048555435635, -0.06916273500452565, 0.12262896262655934, -0.1258990730082181, -0.045154708328030285, 0.017672197945472878, -0.026964746612395552, 0.0654566143397756, -0.008999603868222985, -0.09368852752983751, 0.02584746142769195, 0.04787979754120641, 0.07117929815373257, -0.09728565185977867, -0.042865637712564, -0.06867221823941137, 0.014933483151118325, -0.022863490329434903, -0.13810747733943352, 0.07085229459872341, 0.07821003152485512, -0.022318473318261534, 0.030793495429096835, -0.07145181185595587, 0.10093726604250569, -0.11587075127227865, -0.08693031409690219, -0.09657712579580947, 0.02279536242354274, 0.009973822944938614, 0.07057978297515476, -0.06681916414300029, -0.07237833890416141, -0.037415461364866405, -0.0922714795592084, 0.04417367687645637, -0.05869839882818565, 0.008515900101563384, -0.006846783867904417, 0.022263968914893163, -0.06109647617173404, 0.11456270171511308, 0.03501738194266338, -0.0015328620847983579, 0.0009938055742378864, 0.0171408044368233, 0.009544620879396351, 0.16655737904180393, -0.05057763559202566, -0.014442967425331365, -0.019089241758792702, -0.07248734355358886, -0.022100465058733938, 0.01708630419076421, -0.07488542089713726, 0.07036177367629984, 0.014088705432674088, -0.10725946503504045, 0.02467567183961998, 0.07248734355358886, -0.04733478053003304, 0.02379001945629509, -0.01258990730082181, 0.015941765765049108, -0.01937537688488514, 0.005770374387408794, -0.15805509953264782, -0.06251352206370851, -0.043056391691752766, -0.03357308696698669, -0.006223419868887796, -0.0788095508607422, 0.0459449837217608, -0.020955927672346154, -0.030793495429096835, -0.05414750044499138, -0.04120333135937775, -0.12371899664890607, -0.030030471197723195, 0.05907990886521783, -0.07891855551016967, 0.03706119833288181, -0.051776676342454496, -0.05749936015641145, -0.07314136313553506, 0.03869625144505655, -0.06207750762330796, 0.04033130247857665, -0.0666556571688591, 0.029376450576449692, 0.09101794064137513, 0.051585916127301804, 0.030439233436439558, 0.06758218421706463, 0.08164364056603651, 0.0437376665933651, 0.07232383657944767, -0.005726091560377086, 0.06616513624643552, 0.09036392313808359, -0.076520474009312, -0.09952021807187658, 0.039813538708414795, -0.05221268662554576, -0.027809524330839788, -0.0613689836379934, -0.13440134004544635, 0.041148831113318664, 0.03959552940955987, -0.04717127563454649, 0.04580873206728575, 0.06453008729157007, -0.09423354246235624, -0.008624903503798059, 0.01640502928915188, -0.024989058128069282, 0.0437376665933651, 0.09352502055569632, -0.030902500078524298, -0.009265299583220452, 0.09041842130548804, -0.05297571293557404, -0.09554159201952182, -0.07395889177027706, -0.03572590592797793, -0.04703502190141681, 0.011574811688436349, -0.09341602214223281, 0.10965754861455278, 0.07275985101984823, -0.01685466931073086, -0.09129045226494378, 0.025193439767091125, -0.08436872562190334, 0.020165651239288325, -0.014306712652874363, 0.07428590363990481, -0.015614754726883229, 0.004165978521087328, 0.08360570346918433, 0.018203589375467812, 0.028286413436120993, -0.014442967425331365, 0.03597116431053507, -0.05319371807711969, -0.06267702903784969, 0.029349198374765507, 0.060278949615646664, 0.04657175422000476, -0.04142134065823267, -0.03648892808069693, -0.1471547593091805, -0.03518088891680456, 0.0036822753780241203]}}, {'id': 'https://huggingface.co/papers/2410.13370', 'title': 'MagicTailor: Component-Controllable Personalization in Text-to-Image Diffusion Models', 'url': 'https://huggingface.co/papers/2410.13370', 'abstract': 'Recent advancements in text-to-image (T2I) diffusion models have enabled the creation of high-quality images from text prompts, but they still struggle to generate images with precise control over specific visual concepts. Existing approaches can replicate a given concept by learning from reference images, yet they lack the flexibility for fine-grained customization of the individual component within the concept. In this paper, we introduce component-controllable personalization, a novel task that pushes the boundaries of T2I models by allowing users to reconfigure specific components when personalizing visual concepts. This task is particularly challenging due to two primary obstacles: semantic pollution, where unwanted visual elements corrupt the personalized concept, and semantic imbalance, which causes disproportionate learning of the concept and component. To overcome these challenges, we design MagicTailor, an innovative framework that leverages Dynamic Masked Degradation (DM-Deg) to dynamically perturb undesired visual semantics and Dual-Stream Balancing (DS-Bal) to establish a balanced learning paradigm for desired visual semantics. Extensive comparisons, ablations, and analyses demonstrate that MagicTailor not only excels in this challenging task but also holds significant promise for practical applications, paving the way for more nuanced and creative image generation.', 'score': 2, 'issue_id': 192, 'pub_date': '2024-10-17', 'pub_date_ru': '17 октября', 'hash': 'fa9ce7d280c285b4', 'data': {'desc': 'Эта статья представляет новый подход к персонализации генерации изображений с помощью текстовых запросов. Авторы предлагают метод MagicTailor, который позволяет пользователям точно контролировать отдельные компоненты визуальных концепций. Система использует динамическое маскированное ухудшение (DM-Deg) для устранения нежелательных визуальных элементов и двухпоточную балансировку (DS-Bal) для сбалансированного обучения желаемой семантики. Эксперименты показывают, что MagicTailor превосходит существующие методы и открывает новые возможности для креативной генерации изображений.', 'emoji': '🎨', 'title': 'Точный контроль над компонентами в персонализированной генерации изображений', 'categories': ['#cv', '#diffusion', '#multimodal'], 'embedding': [0.050726294702759474, 0.0692375256054019, 0.06437487284005465, 0.035309478077254014, -0.03522659183401018, -0.08995905359256352, 0.051582782463800214, 0.11045954612710865, -0.09498747474142376, 0.07387914702110737, 0.02022420847621125, -0.040862848168641684, -0.045145297231282085, -0.077305102168245, 0.06735877349385808, -0.07736036513437383, 0.05498111228233547, -0.030004768767085205, 0.04097336384346258, 0.012446729866895623, -0.011161994942954768, -0.041746965361259485, -0.025307888488225617, 0.0797916894655601, 0.011541889369702626, 0.012274050022513685, 0.05923593396488616, 0.09460066680231961, 0.08802503851489088, 0.012474358067580278, 0.028236532330362264, -0.04387437620253483, -0.09780559675427748, -0.15659946596839272, -0.003156579062144222, 0.12211885442655175, 0.0033827889812937375, 0.08498588310090802, -0.041415422439771477, 0.03823811986790332, 0.003367247938903477, 0.0016931212275460676, 0.06498270392285121, 0.1605780076955842, 0.03821049248781361, -0.0024002434772981717, 0.013289404963635175, 0.10775193158312645, -0.028001688316419287, 0.06282766570148615, -0.03796183580956944, 0.03768554969974822, -0.07520531870705938, -0.03727111643204169, -0.09272191879375047, 0.050809180946003306, -0.08012323238704812, 0.01504382750516452, -0.07807870984050394, 0.019782149879902355, -0.005840016622604087, 0.005567182755688854, -0.031828264066962264, 0.051720929621685514, -0.11128840855954703, -0.03569628191338348, -0.1213452508572675, 0.03492267629261189, -0.03459113131963655, -0.013102911224059644, 0.06912700787909366, -0.009110563807623933, -0.11979804371869902, 0.008074487408265852, 0.006147385637800771, -0.013627856679058581, -0.05520214158048992, 0.06188828964571424, 0.04520055609443621, -0.06487218619654297, 0.0694032939889149, -0.06559053295416044, -0.0010386664021325121, 0.027642515963354226, -0.14190101046091616, 0.005960891898225241, 0.009207264766656299, -0.060506854993633424, -0.11217252575216481, -0.10156310713182719, -0.01708835210319603, 0.061280456511430326, -0.008274796273927382, 0.03973007019480503, 0.03453587655945712, -0.0322426932316941, -0.035558136806985524, -0.017544223363806108, 0.09940806685897478, 0.07365811977444027, 0.046692506421337925, -0.005328885678244946, -0.01826257012142358, 0.0049420840987515575, 0.11780877388084694, -0.05929119282804029, -0.052632676245880375, 0.009683859331841585, -0.06437487284005465, 0.0353923663719852, -0.08774875240506966, -0.08703040564745218, 0.027725400155110717, 0.07459748967575015, 0.044592720908664944, -0.18743310537386568, -0.052024843111596455, 0.05790975407298477, 0.02023802319199978, -0.046139930098720784, -0.03384515718192937, 0.01479516877543301, 0.016259489670757663, -0.007950158658846301, 0.03890121186534136, -0.1233345165921449, -0.00828860996397224, -0.12841820481010863, -0.013952493678693459, -0.08990378652346002, -0.0032101097523580028, 0.013379198359624542, 0.09404809868565185, -0.024244186144818963, -0.08631206299280941, -0.02353965205150268, -0.04252056893054373, 0.046913535719492375, -0.04453746204551083, 0.029700853225686916, -0.06780083619314166, -0.027808286398354552, 0.010312412078023482, 0.004558735787907833, -0.05282607406097042, -0.10769667887443436, 0.06979010192801904, 0.09719776772296826, -0.04904094245779302, 0.11825083658013053, -0.12720253443856613, -0.08863286959768744, 0.00015120238023451707, -0.0860357686770388, -0.050726294702759474, -0.11311189360198735, 0.030253427496816712, 0.00986344571352285, -0.017668553754415537, -0.09874497896451144, -0.0495382578657687, 0.002075606067365825, -0.018082982919147374, 0.012073742182595828, 0.003298176001150702, -0.014228780403960887, 0.018221128025545333, 0.07233193577956419, -0.121897829231372, -0.0791838522283015, 0.032380840389579404, -0.08249929580359293, -0.09719776772296826, -0.05614152173923653, 0.03931563897858585, 0.09824766355653576, -0.04696878842818446, -0.06791134981647522, -0.056169149119326245, -0.013593320710182195, -0.0488751720227927, 0.13582269963295043, -0.056058631393018005, 0.0049835268100760065, -0.03884595300218724, -0.0900143063012556, -0.028015503032207817, 0.004230644904177089, 0.0051976491606336595, -0.03370701412701876, -0.10018166837677168, 0.11902444425238946, 0.08272032920472207, -0.026136750920663983, 0.0033447995386189514, -0.009262521988620544, 0.09620313280404222, 0.02959033755086602, 0.020790597463129577, -0.06415383943892551, 0.0721109085328971, 0.0797916894655601, 0.001638727271457055, -0.009524994203248177, 0.04765950780571221, 0.03285052431449067, 0.013206518515242604, 0.02667551047600525, 0.0002872953140896178, -0.026261079259786064, 0.08078631617853677, -0.08415702066846965, 0.03312681247579924, -0.03221506380011704, -0.08144940817597479, -0.04497952679628176, -0.08995905359256352, -0.026440666462062265, 0.001883931911943963, 0.10990696980449151, -0.029838996280597527, 0.03373464150710847, 0.09310872262987994, 8.013402115900118e-05, -0.11349870154109151, -0.0024744954205998095, -0.0018908392698382282, -0.05141701408028723, -0.004724507658949302, -0.051499898272043716, 0.12101370998726685, -0.01250889383130793, 0.02206151849187684, -0.04589126931750193, 0.02439614186403076, -0.04017212879111393, 0.04047604843548691, -0.10344185924337103, 0.07890756816996762, -0.051444641460376944, -0.006896814275050026, 0.04964877559207694, 0.0023242645919486003, -0.05868335969375637, -0.09089842349387339, 0.07454223491557072, -0.05489822603909164, 0.04881991315963858, -0.005004248063163864, -0.035447621132164625, 0.07846550752217138, -0.0423547984955434, -0.08426753839477791, -0.003324077875233625, 0.01986503612314619, -0.020735340651462802]}}];
        const articlesContainer = document.getElementById('articles-container');
        const sortDropdown = document.getElementById('sort-dropdown');
        const categoryFiltersContainer = document.getElementById('category-filters');
        const categoryToggle = document.getElementById('category-toggle');
        const clearCategoriesButton = document.getElementById('clear-categories');
        let selectedCategories = [];
        let selectedArticles = [];
        let sortBy = 'issue_id';     

        function getUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const categoriesParam = urlParams.get('cat');
            let categories = categoriesParam ? categoriesParam.split(',') : [];
            categories = categories.map(element => `#${element}`);
            return categories
        }

        function updateUrlWithCategories() {
            let cleanedCategories = selectedCategories.map(element => element.replace(/^#/, ''));
            const newUrl = cleanedCategories.length > 0 
                ? `${window.location.pathname}?cat=${cleanedCategories.join(',')}`
                : window.location.pathname;
            console.log("cleanedCategories", cleanedCategories)
            window.history.pushState({}, '', newUrl);
        }

        function loadSettings() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            const themeToggle = document.getElementById('theme-toggle');
            let settingSortBy = localStorage.getItem('sort_by');
            const sortDropdown = document.getElementById('sort-dropdown');
            
            if (isDarkMode) {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                themeToggle.checked = true;
                const title = document.getElementById('doomgrad');
                title.innerHTML = "хф найтли";
                const titleSign = document.getElementById('doomgrad-icon');
                titleSign.classList.add('rotate');
            }

            if ((!settingSortBy) || (settingSortBy === 'null')) {
                settingSortBy = 'issue_id';
            }
            
            sortDropdown.value = settingSortBy;
            sortBy = settingSortBy;
        }

        document.getElementById('theme-toggle').addEventListener('change', toggleTheme);

        function getUniqueCategories(articles) {
            const categories = new Set();
            articles.forEach(article => {
                if (article.data && article.data.categories) {
                    article.data.categories.forEach(cat => categories.add(cat));
                }
            });
            return Array.from(categories);
        }
        
        function createCategoryButtons() {
            const categories = getUniqueCategories(articlesData);
            categories.forEach(category => {
                const button = document.createElement('span');
                button.textContent = category;
                button.className = 'category-button';
                button.onclick = () => toggleCategory(category, button);
                categoryFiltersContainer.appendChild(button);
            });
        }

        function toggleCategory(category, button) {
            const index = selectedCategories.indexOf(category);
            if (index === -1) {
                selectedCategories.push(category);
                button.classList.add('active');
            } else {
                selectedCategories.splice(index, 1);
                button.classList.remove('active');
            }         
            filterAndRenderArticles();
            saveCategorySelection();
            updateSelectedArticlesTitle();
            updateUrlWithCategories();
        }

        function saveCategorySelection() {
            localStorage.setItem('selectedCategories', JSON.stringify(selectedCategories));
        }

        function updateSelectedArticlesTitle() {
            if (selectedArticles.length === articlesData.length) {
                categoryToggle.textContent = '🏷️ Фильтр';
            } else {
                categoryToggle.textContent = `🏷️ Фильтр (${formatArticlesTitle(selectedArticles.length)})`;
            }
        }

        function cleanCategorySelection() {
            localStorage.setItem('selectedCategories', JSON.stringify('[]'));
        }

        function loadCategorySelection() {
            const urlCategories = getUrlParameters();
            if (urlCategories.length > 0) {
                selectedCategories = urlCategories;
                saveCategorySelection();
            } else {
                const savedCategories = localStorage.getItem('selectedCategories');
                if (savedCategories && savedCategories !== '"[]"') {
                    selectedCategories = JSON.parse(savedCategories);                    
                }
            }
            updateCategoryButtonStates();
        }

        function updateCategoryButtonStates() {
            const buttons = categoryFiltersContainer.getElementsByClassName('category-button');
            Array.from(buttons).forEach(button => {
                if (selectedCategories.includes(button.textContent)) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        function filterAndRenderArticles() {
            console.log(selectedCategories);
            let filteredArticles = selectedCategories.length === 0
                ? articlesData
                : articlesData.filter(article => 
                    article.data && article.data.categories && 
                    article.data.categories.some(cat => selectedCategories.includes(cat))
                );

            console.log('filteredArticles', filteredArticles)

            if (filteredArticles.length === 0) {
                selectedArticles = articlesData;
                selectedCategories = [];
                cleanCategorySelection();
            } else {
                selectedArticles = filteredArticles;
            }

            console.log('selectedArticles', selectedArticles)

            sortArticles(selectedArticles);
        }

        function clearAllCategories() {
            selectedCategories = [];
            updateCategoryButtonStates();
            filterAndRenderArticles();
            saveCategorySelection();
            updateSelectedArticlesTitle();
            updateUrlWithCategories();
        }

        function renderArticles(articles) {
            console.log(articles);
            articlesContainer.innerHTML = '';
            articles.forEach((item, index) => {
                if ("error" in item) {
                    console.log(`Omitting JSON. ${item["raw_data"]}`);
                    return;
                }
                const explanation = item["data"]["desc"];
                const cats = item["data"]["categories"].join(" ");
                const articleHTML = `
                    <article class='x${item["hash"]}'>
                        <div class="background-digit">${index + 1}</div>
                        <div class="article-content" onclick="toggleAbstract(${index})">
                            <h2>${item['data']['emoji']} ${item['title']}</h2>
                            <p class="meta"><svg class="text-sm peer-checked:text-gray-500 group-hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 12 12"><path transform="translate(0, 2)" fill="currentColor" d="M5.19 2.67a.94.94 0 0 1 1.62 0l3.31 5.72a.94.94 0 0 1-.82 1.4H2.7a.94.94 0 0 1-.82-1.4l3.31-5.7v-.02Z"></path></svg> ${item['score']}. ${item['data']['title']}</p>
                            <p class="pub-date">📅 Статья от ${item['pub_date_ru']}</p>
                            <div id="abstract-${index}" class="abstract">
                                <p>${explanation}</p>
                                <div id="toggle-${index}" class="abstract-toggle">...</div>
                            </div>
                            <div class="links">
                                <a href="${item['url']}" target="_blank">Статья</a>
                            </div>
                            <p class="tags">${cats}</p>
                        </div>
                    </article>
                `;
                articlesContainer.innerHTML += articleHTML;
            });
        }
        
        function sortArticles() {
            let sortedArticles = [...selectedArticles];
            if (sortBy === 'issue_id') {
                sortedArticles.sort((a, b) => b.issue_id - a.issue_id);
            }
            if (sortBy === 'pub_date') {
                sortedArticles.sort((a, b) => b.pub_date.localeCompare(a.pub_date));
            }
            renderArticles(sortedArticles);
            localStorage.setItem('sort_by', sortBy);
        }
        
        sortDropdown.addEventListener('change', (event) => {
            sortBy = event.target.value;
            sortArticles(event.target.value);
        });

        categoryToggle.addEventListener('click', () => {
            categoryFiltersContainer.classList.toggle('expanded');
        });

        clearCategoriesButton.addEventListener('click', clearAllCategories);
        
        function updateTimeDiffs() {
            const timeDiff = document.getElementById('timeDiff');
            timeDiff.innerHTML = '🔄 ' + getTimeDiffRu('2024-10-21 04:15');
        } 

        loadSettings();
        createCategoryButtons();
        loadCategorySelection();
        filterAndRenderArticles();
        updateSelectedArticlesTitle();
        updateTimeDiffs();  
    </script>
</body>
</html>
    